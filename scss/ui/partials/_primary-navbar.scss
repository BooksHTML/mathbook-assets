@import "../ui_config";
@import "../mixins/buttons";
@import "compass/css3";

////////////////////////////////////////////////////////////////////////////////
// Config
////////////////////////////////////////////////////////////////////////////////
// Note: These variables should only depend on ui module variables

$navbar-color:change-color($ui-color-base, $lightness: 20%) !default;
$navbar-bg-color: change-color($ui-color-base, $lightness: 93%) !default;

$navbar-border-width: 1px !default;

$navbar-shadow-color:rgba(black,.3) !default;
$navbar-shadow-spread: 5px !default;
$navbar-shadow-offset: 2px !default;

$navbar-top-box-shadow:
    $navbar-shadow-color 0 $navbar-shadow-offset $navbar-shadow-spread;
$navbar-bottom-box-shadow:
    $navbar-shadow-color 0 -$navbar-shadow-offset $navbar-shadow-spread;

$navbar-icon-size: $ui-icon-size;
$navbar-icon-box-size: $ui-icon-box-size;

// Some curry for navbar-buttons
@mixin navbar-button($icon, $side: left) {
    $icon-only-breakpoint: $ui-screen-sm-min;
    @include icon-button(
        $icon, 
        $navbar-icon-size, 
        $navbar-icon-box-size, 
        $side,
        $icon-only-breakpoint);
}

////////////////////////////////////////////////////////////////////////////////
// Styles
////////////////////////////////////////////////////////////////////////////////

& { 
    background:$navbar-bg-color;
    border-bottom:$navbar-border-width solid darken($navbar-bg-color, 15%);
    z-index:200;
    height: 2.8em;
    font-family: $ui-font-family-serif;

    /* Smoothly transition box-shadow when navbar sticks/unsticks */
    @include single-transition(box-shadow, 400ms);
}

/* Styles applied to make the navbar persistently visible */
.stuck & {
    position:fixed;
    top:0;
    right:0;
    left:0;
    @include box-shadow( $navbar-top-box-shadow);
}

@media screen and (max-width: $ui-screen-sm-min) {
    /* 
     * At small screen sizes, turn the navbar into a full bar along bottom 
     * When stuck and when not stuck. We don't care about stuck at this size.
     */
    &, .stuck & {
        position:fixed;
        top: auto;
        bottom:0;
        left:0;
        right:0;
        background:$navbar-bg-color;
        @include box-shadow($navbar-bottom-box-shadow);
    }
}

.button {
    float:left;
    position:relative;
    /* subtract border and padding from width 
     * so we can set width precisely as percent */
    box-sizing:border-box;

    // TODO move to a button mixin?
    //----------------------------------------------------
    /* Override link properties */
    &, &:hover, &:visited, &:link, &:active {
        display:block;
        color: $navbar-color;
        text-decoration:none;
        background-color:transparent;
    }

    font-size:1em;
    padding:0 1.4em;
    margin:0;
    line-height:2.8;

    cursor:pointer;
    @include user-select(none);
    outline:none; /* Don't display outline on click */

    border:1px solid; 
    border-color:darken($navbar-bg-color, 30%);
    border-top:none;
    border-bottom:none;

    @include transition-property(text-indent,background-color);
    @include transition-duration(200ms);

    /* hover state */
    &:hover {
        background-color:lighten($navbar-bg-color, 5%);
    }

    /* active/pressed state */
    &.active, &:active {
        background-color:darken($navbar-bg-color, 5%);
        @include box-shadow(rgba(black,.5) 0 2px 5px inset);
    }
    //----------------------------------------------------

    /* Icon only at small screen sizes */
    @media screen and (max-width:$ui-screen-sm-min) {

        @include without-text(
            $navbar-icon-box-size, 
            $navbar-icon-box-size);

        float:left;
        text-align:center;
        margin:0;
        width:25%;
        border-right:none;

        &:first-child {
            border-left:none;
        }

        &.active, &:active {
            /* Vertically flip shadow for lower navbar */
            @include box-shadow(rgba(black,.5) 0 -2px 5px inset);
        }
    }
}

#sidebar-left-toggle-button, #sidebar-right-toggle-button {
    position:relative;
    height:2.8em;
}

#sidebar-left-toggle-button {
    /* Do not display if has-sidebar-left is missing */
    display:none;

    .has-sidebar-left & {
        display:block;
    }

    /*On big screens, */
    @media screen and (min-width: $ui-screen-sm-min + 1) {
        &.active {
            /* Show text if hidden and match sidebar width */
            text-indent:0;
            width:$ui-sidebar-left-width;
        }
    }

    /* ion-navicon-round */
    @include navbar-button("\f20d");
}

#sidebar-right-toggle-button {
    /* Do not display if has-sidebar-right is missing */
    display:none;

    .has-sidebar-right & {
        display:block;
    }

    /* ion-chatbox */
    @include navbar-button("\f2e1");

    /*On big screens, */
    @media screen and (min-width: $ui-screen-sm-min + 1) {
        float:right;

        &.active {
            /* Show text if hidden and match sidebar width */
            text-indent:0;
            width:$ui-sidebar-right-width;
        }
    }
}

.previous-button {
    /* ion-chevron-left */
    @include navbar-button("\f124");
}

.next-button {
    /* ion-chevron-right */
    @include navbar-button("\f125", right);
}

@media screen and (min-width: $ui-screen-sm-min + 1) {
    /*On big screens, 
     * we use the prev/next inside the main container */
    .next-button, .previous-button {
        &, &:link, &:visited, &:hover, &:active {
            display:none;
        }
    }
}
