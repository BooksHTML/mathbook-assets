// Knowl
@import "shared/typography";

$brand-primary: gray !default;

// Link colors
$knowl-link-color: saturate($brand-primary, 10%) !default;
$knowl-link-color-hover: saturate(darken($brand-primary, 10%), 10%) !default; 

// Border colors
$knowl-border-color: change-color($brand-primary, 
                                  $saturation: 100%,
                                  $lightness: 92%) !default;
$knowl-border-color-bold: $knowl-border-color !default;

// Background colors
$knowl-bg-color: change-color($knowl-border-color, 
                              $saturation: 90% ,
                              $lightness: 99%) !default;
$knowl-within-knowl-bg-color: white !default;

// Layout
$knowl-border-width:10px !default;
$knowl-padding:10px !default;
$knowl-link-border-radius: 3px !default;
$knowl-border-radius: 4px !default;

@mixin knowl() {
    /* The knowl drawer */
    .knowl-output {
        @include knowl-output();
    }

    /* Links that open knowls */
    *[knowl] {
        @include knowl-link();
    }
}

@mixin knowl-link(
    $color: $knowl-link-color,
    $border-color: $knowl-border-color,
    $border-radius: $knowl-link-border-radius
) {
    &, &:hover, &.active {
        color: $color;
        background: transparent;
        padding:0px 3px;
        margin:0;
        text-decoration:none;

        /* David likes 1px border in default state, but 2px is definitely
         * better in hover state, so we add a bottom margin so the line
         * doesn't jump onHover.
         */
        margin-bottom: 1px;
        border-bottom: 1px dotted $color;
        
        font-weight:500;
        //line-height:1.3;
        white-space: nowrap;
        @include inline-block(baseline);
        @include border-top-left-radius($border-radius);
        @include border-top-right-radius($border-radius)
    }

    &:hover, &.active {
        color: darken($border-color, 65%);
        background: lighten($border-color, 4%);
        text-decoration:none;

        /* See comment on default style's border/margin */
        margin-bottom:0;
        border-bottom:2px solid darken($border-color, 15%);
    }

    &.active {
        background: $border-color;
    }
}

@mixin knowl-output(
    $bg-color: $knowl-bg-color,
    $child-bg-color: $knowl-child-bg-color,
    $border-width: $knowl-border-width,
    $border-color: $knowl-border-color,
    $border-color-bold: $knowl-border-color-bold,
    $margin-bottom: $knowl-margin-bottom,
    $border-radius: $knowl-border-radius
) {
    & {
        border: $border-width solid $knowl-border-color;
        background: $bg-color;
        @include border-radius($border-radius-large);
        margin-bottom:$line-height-computed;
    }

    .knowl-footer {
        font-size:x-small;
        color: darken($border-color, 60%);
        background: $border-color;
        bottom: -$border-width;
        padding:1px 0px 1px $border-width;
    }

    // TODO recursive solution?
    & .knowl-output {
        & {
            border-color: $border-color-bold;
            background: $child-bg-color;
        }

        /* All knowls within knowls should have this  */
        &, & > .knowl-output {
            border-width: $border-width / 2;
            border-bottom-width: $border-width;
        }

        .knowl-footer {
            color: darken($border-color, 60%);
            // color: desaturate(darken($border-color-bold, 60%), 80%) ;
            background: $border-color-bold;
        }
    }

    .knowl-content {
        padding: $knowl-padding;
    }

    @include typography-code-inline(white, $knowl-border-color);
    @include typography-code($bg-color: white, 
                             $border-color: $knowl-border-color-bold);
}
