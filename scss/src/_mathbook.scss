/**!
* The default styles for Mathbook-based textbooks.
*
* @author Michael DuBois (michael@michaeldubois.me)
*/

// Note: single line comments like this are not included in css output
//
// Naming Conventions
// ------------------
// Unfortunately, SASS uses the dash-separated scheme for variables.
// So variables should take the following form: $my-awesome-var
//
// The portions of a variable name should be ordered from general to specific.
// i.e. $color-button-primary not $primary-button-color
//
// Whenever possible, avoid variable names that describe their current value.
// i.e. use $color-button-primary instead of $color-button-red

// Real CSS imports first
@import url(http://fonts.googleapis.com/css?family=PT+Serif:400,700);

// SASS imports w/o output
@import "variables";
@import "typography";
@import "numbering";
@import "compass/reset/utilities";
@import "heading";
@import "knowl";
@import "utilities";

// Perform standard reset
@include reset-html5();

// Global SASS imports w/ output
@import "mathjax";

/* Override default styling of address */
address {
    padding:0;
    margin:0;
    line-height: inherit;
    font-style: inherit;
}

html, body {
    margin:0;
    padding:0;
}

body {
    /* Override this in <style> tag if necessary */
    counter-reset:chapter;
    background:#ddd;
}

/* 
 * Containers restrict max-width of content within elements 
 * that may stretch to the width of the viewport. 
 *
 * We are not currently using them since the layout is left-aligned.
 */
.container {
    // For centered layout:
    //max-width:960px;
    //margin:0 auto;
}


#masthead {
    @import "masthead";
}

/* The horizontal navbar */
#navbar {
    @import "navbar"
}


/**
 * highlighting menu entries (if their respective blueprint overwirtes 
 * the body_class variable!)
 */
body.mwf #sidebar a.mwf { background: #BFB; }
body.cmf #sidebar a.cmf { background: #BFB; }
body.local_fields #sidebar a.local_fields { background: #BFB; }

.page {
    $toc-open-max-width:$page-max-width;
    $toc-closed-max-width:$page-max-width - $toc-width;

    // For centered layout:
    //margin:0 auto;

    .has-toc & {
        max-width:$toc-open-max-width;
        @include single-transition(max-width, 200ms);
    }

    .has-toc.toc-closed & {
        max-width:$toc-closed-max-width;
    }
}

.main {
    position:relative; // For toc content overlay at smaller screen sizes
    min-height:100%;

    display:block;
    width: auto;
    margin: 0 auto;
    padding:0;

    background:white;

    border:1px solid #ccc;
    /* transparent instead of none to fix margin-top box-model issue */
    border-top-color:transparent;
    border-bottom-color:transparent;
    //@include box-shadow(0 5px 5px rgba(0,0,0,.5));

    /* If table-of-contents (toc) is visible */
    .has-toc & {
        margin-left:$toc-width;
        @include single-transition(margin-left, $toc-transition-duration);

        /*
         * We do not display the content overlay in the larger layout
         * where the toc does not overlap the content when it is open. 
         *
         * But we do need an initial state to transition from when displaying
         * the overlay (so the background fades in)
         */
        &:before {
            display:none;
            background-color: rgba(black,0);
            @include single-transition(background-color, 
                                       $toc-transition-duration);

            /* Positional attributes that should be true even if display:none */ 
            position: absolute;
            top:0;
            right:0;
            bottom:0;
            left:0;
            z-index: 50;
        }

        @media only screen and (max-width: $screen-sm-min) {
            /* 
             * At small widths, allow toc to overlay the content  when open
             * This way, when nav items jump to other points in the page,
             * the calculations will be spot on because the content width wasn't
             * compressed by the toc.
             * 
             * This is simpler than the alternative possibility where we
             * fix the width of the content in the javascript and push
             * it off the side of the screen.
             */
            margin-left:0;

            /* Fade out content while toc is overlapping it */
            &:before {
                content:"";
                display:block;
                background-color:rgba(black, .5);
                @include single-transition(background-color, 
                                           $toc-transition-duration);
            }
        }
    }

    /** 
     * When toc is closed, we remove the margin. 
     * CSS transitions make it slide.
     */
    .has-toc.toc-closed & {
        margin-left:0;

        /* Hide content overlay when toc isn't showing! */
        &:before {
            display:none;
            background-color: rgba(black,0);
            @include single-transition(background-color, 
                                       $toc-transition-duration );
        }
    }

    /* Root content wrapper (the page) */
    //& > .article,
    //& > .section,
    & > #content {
        margin:3em; /* these are the page margins */
    }
}

/* The homepage or "cover" of the mathbook */
.frontmatter {
    @include heading {
        text-align:center;
    }

    .contributors {
        text-align:center;
        font-style:normal;
        color:$gray-dark;
    }
}

/* Abstract for papers? */
.abstract {
    @include heading {
        &:after {
            content: ". ";
        }
    }
}

@import "chapter-index";

/***************************************************************************
 * Sectioning
 **************************************************************************/
/**
 * Section elements. These come in many different flavors.
 * Some styles are applied to all of them, and some to specific flavors.
 */
// NOTE: Be sure you understand the & selector in SASS.
section {

    /* Default heading style */
    @include heading {
        .type {
            &:after {
                content: " ";
            }
        }

        .codenumber {
            &:after {
                content: ": ";
            }
        }

        .title {}
    }

    /* Defaults for child "section"s  */
    &.chapter .section,
    &.chapter .preface, 
    &.chapter .introduction, 
    &.chapter .conclusion, 
    &.subsection, 
    &.subsubsection  {
        margin: #{2*$line-height-base}em 0;
    }

    /* A section representing a Chapter in the mathbook */
    &.chapter {

        /* Styles applied to both <header> format and non-<header> format */
        &, & > header {
            @include heading {

                $title-font-size: $font-size-h2;
                // calculate 1 standard line's height in terms of title's font-size
                $gap:em($line-height-computed, $title-font-size);
                $prefix-font-size: $font-size-h3;

                & {
                    /* 
                     * We use font-size-base to calculate proper line-heights 
                     * for vertical rythym
                     */
                    font-size: $font-size-base;
                    margin-bottom: em(2*$line-height-computed);
                }

                .title {
                    /* Chapter title goes on it's own line (as in LaTeX) */
                    display:block;
                    font-size: $title-font-size;
                    margin-top: $gap;
                }

                .codenumber, .type {
                    /* Chapter titles are smaller (as in LaTeX) */
                    font-size: $prefix-font-size;
                }

                .codenumber:after {
                        content: "";
                }
            }
        }

        /** 
         * Chapter heading in the <header> format
         * This format supports a byline for anthology textbooks 
         * and journals with different chapter authors.
         */
        header {

            & {
                margin-bottom: em(2*$line-height-computed);
            }

            @include heading {

                & {
                    margin-bottom: em($line-height-computed);
                }

                .title {
                    /* The margin goes on the header element instead */
                    margin-bottom:0;
                }

            }

            .byline {
                margin:0;
                color: $gray-light;
                &:before { content: "By "; }
            }
        }

        /* Sections inside of chapters */
        .section, .preface, .introduction, .conclusion {

            @include heading {
                font-size: $font-size-h3;
            }

            .subsection {
                @include heading {
                    font-size: $font-size-h4;
                }

                .subsubsection, .subsection {
                    @include heading {
                        font-size: $font-size-h5;
                    }
                }
            }
        }
    }

    /* Root-level "section"s */
    &.section, &.preface, &.introduction, &.conclusion {
        @include heading {
            font-size: $font-size-h2;
        }

        .subsection {
            @include heading {
                font-size: $font-size-h3;
            }

            .subsubsection, .subsection {
                @include heading {
                    font-size: $font-size-h4;
                }
            }
        }
    }

    /* Hide environment type on section headings */
    // TODO introduction/preface/conclusion too?
    &.section, &.subsection, &.subsubsection {
        @include heading {
            .type {
                display:none;
            }

            .codenumber:after {
                content: " ";
            }
        }
    }
}

// TODO this seems unnecessary/bad, test without
/*.subsection {*/
    /* to make more space above 
     * the next subsection, when a subsection
     * ends with a theorem
     */
    /*.theorem-like:last-child { margin-bottom: 30px }*/
/*}*/

/***************************************************************************
 * Typography!
 **************************************************************************/
@include typography();

/***************************************************************************
 * Knowls
 **************************************************************************/
@include knowl();

/* restyle knowls at first and third depth */
.knowl-output, .knowl-output  .knowl-output  .knowl-output {
    @include knowl-output();
    @import "exercises"; // TODO what's going on here ?
    @include exercise($knowl-border-color);
    @include exercisegroup($knowl-border-color, darken($knowl-border-color, 0%));
}

// TODO is this old?
.annotatedacronyms { margin: 15px 0 0 0; }

.diagram {text-align:center; margin-bottom:2em}

// TODO what's this?
.context {text-align:right}

// TODO what's this?
.attribution {
    text-align:right;
}

// TODO move to typography?
.terminology {
    font-style:italic;
    font-weight:bold;
}

.next-button {
    @include ui-button-directional($direction:right);
}

